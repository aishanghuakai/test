<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title></title>
	{include file="./static/html/header_common.html" /}	
    <style>
	form .row{
  margin-left:30px;
  margin-bottom:0px;
  margin-right:30px;
  margin-top:5px;
}
.row .col.s6 {
    width: 100%;
    margin-left: auto;
    left: auto;
    right: auto;
}
.row input{
  margin:0 0;
  padding:0 0;
}
.form-control{
   text-indent:10px;
}
.alert {
    padding: 0px;
    margin-bottom: 0px;
    border: 1px solid transparent;
        border-top-color: transparent;
        border-right-color: transparent;
        border-bottom-color: transparent;
        border-left-color: transparent;
    border-radius: 4px;
}
	</style>	
</head>
<body>
    <div id="wrapper">
	     {include file="./static/html/header.html" /} 
	
		<div class="hw_page_content">
		    <div class="hw_menu_left">
         {include file="./static/html/side.html" /}  
			</div>
		    <div class="hw_content_right">	
			  <ul class="search_tab clearfix" >
			      <li  ><a  href="javascript:;" onclick="window.history.go(-1);">返回</a></li>
			      <li class="active" ><a  href="javascript:;">广告配置</a></li>
                  <li style="margin-left:48%;" ><a style="width:200px;color: #333;" href="javascript:;"><span style="font-size:16px;">{$app_name}</span></a></li>				  
		       </ul>
			      								
					<select class="form-control" id="selectcountry" style="width:180px;margin-left:75%;margin-top:30px;margin-bottom:30px;">
						  <option value="country">选择国家</option>
						   <option value="default">默认</option>
						  {volist name="admincountry" id="cc"}
						  <option  {if condition="$key eq $code"} selected {/if} value="{$key}">{$cc}</option>	
						  {/volist}								  
					</select>						
			      <div class="table-responsive" style="padding:0 30px;clear:both;">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            
                                             <th style="vertical-align:middle; text-align:center;">广告名称</th>
                                             <th style="vertical-align:middle; text-align:center;">广告ID</th>
											 <th style="vertical-align:middle; text-align:center;">广告类型</th>											 
									         <th style="vertical-align:middle; text-align:center;">投放国家</th>
											  <th style="vertical-align:middle; text-align:center;">排序</th>
											 <th style="vertical-align:middle; text-align:center;">修改人</th>
									         <th style="vertical-align:middle; text-align:center;">修改时间</th>
											 <th style="vertical-align:middle; text-align:center;">操作</th>
                                      </thead>
                                    <tbody>
									    {volist name="list" id="item"}
                                        <tr class="dt">
                                            
                                             <td class="dd" style="vertical-align:middle; text-align:center;">{$item.name}</td>
                                             <td class="dd" style="vertical-align:middle; text-align:center;">{$item.prop_value_two}</td>
											 
											 <td class="dd" style="vertical-align:middle; text-align:center;">
											 {if condition="$item['adtype'] eq 'int'"}<div class="alert alert-success">插屏</div>
											{elseif condition="$item['adtype'] eq 'rew'"/}<div class="alert alert-info">激励</div>
											{elseif condition="$item['adtype'] eq 'nat'"/}<div class="alert alert-warning">原生</div>
											{elseif condition="$item['adtype'] eq 'native'"/}<div class="alert alert-warning">原生</div>
											
											{/if}
											
											 </td>
                                            <td class="dd" style="vertical-align:middle; text-align:center;"><div class="alert alert-danger" style="font-weight:bold;"><?php echo $admincountry[$item["prop_value_one"]]; ?></div></td>
											  <td class="dd" style="vertical-align:middle; text-align:center;">{$item.remark}</td>
											 <td class="dd" style="vertical-align:middle; text-align:center;">{$item.updateuser}</td>
											 <td class="dd" style="vertical-align:middle; text-align:center;font-style:italic;">{$item.updatetime|getadvertime}</td>
											 <td style="vertical-align:middle; text-align:center;" >
											 
											  <div class="btn-group">
												  <a  class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
													<i class="fa fa-ellipsis-v"></i>
												  </a>
												  <ul class="dropdown-menu">
												     {if condition="permission(2)" }
													  <li><a class="edit" data-id="{$item.pid}" data-code="{$item.prop_value_one}" data-val="{$item.prop_value_two}" data-cfid="{$item.id}" data-remark="{$item.remark}">修改</a></li>
													 {/if}
													 {if condition="permission(3)" }
													   <li><a data-id="{$item.pid}" class="delete" >删除</a></li>
													 {/if}
												  </ul>
												</div>											 
											 </td>                                           
                                        </tr>
                                        {/volist}
                                    </tbody>
                                </table>
                                 <div>{$list->render()}</div>								
                            </div>
			   
			 </div>
        </div>			 
	   {include file="./static/html/footer.html" /}	
    </div>
	 {include file="./static/html/footer_common.html" /}
    <script>
	  $(function () {
	      
	       $("input[name='type']").click( function(){
		    var code = $("#selectcountry").val();
            window.location.href="/admin_advertisement/getcountrylist?type=<?php echo $type; ?>&id=<?php echo $appid; ?>&code="+code+"&adtype="+$(this).val();
         } );
		 
		 $("#selectcountry").change( function(){
		     var code = $(this).val();
			 if("country"==code)
			 {
			    return false;
			 }
			 if( "default"==code )
			 {
			    window.location.href="/admin_advertisement/adlist?type=1&id=<?php echo $appid; ?>";return;
			 }
			 var adtype = "all";//$("input[name='type']:checked").val();
			 window.location.href="/admin_advertisement/getcountrylist?type=<?php echo $type; ?>&id=<?php echo $appid; ?>&adtype="+adtype+"&code="+code;
		 })
   
	       $(".delete").click( function(event){
		        var id = $(this).attr("data-id");
				var _$ = $(this);
		        layer.confirm('确认删除后数据将不会保存?', {
					  btn: ['确认','取消'] //按钮
					}, function(){
					  var index = layer.load(1, {
								  shade: [0.1,'#fff'] //0.1透明度的白色背景
								});
					   $.post("/admin_advertisement/country_delete",{id:id},function(e){
					       layer.closeAll();
					         if("ok"==e)
							 {
							    _$.parents("tr").remove();
								layer.msg('删除成功');								
							 }else{
							   layer.msg('网络异常,删除失败', {icon: 1});
							 }
					   })
					 
					}, function(){
					  
					});
			   return false;
		   });		
	   $(".edit").click( function(event){
	    var _$ = $(this);
		var id = _$.attr("data-id");
		var cfid = _$.attr("data-cfid");
		var code = _$.attr("data-code");
		var val = _$.attr("data-val");
		var remark = _$.attr("data-remark");
	    var html='<form  style="text-align:center;">';
		    html+='<div class="row"><p style="font-weight:bold;color:#333;">投放国家</p><div class="input-field col s6">';
			html+='<select class="form-control" id=aaxx name="prop_value_one">';
			html+='<option value="country">请选择国家</option>';
			html+='<option  value="US">美国</option>';
			html+='<option  value="TW">台湾</option>';
			html+='<option  value="HK">香港</option>';
			html+='<option value="JP">日本</option>';
			html+='<option  value="KR">韩国</option>';
			html+='<option  value="DE">德国</option>';
			html+='<option  value="FR">法国</option>';
			html+='<option  value="CN">中国</option>';
			html+='<option  value="RU">俄罗斯</option>';
			html+='<option  value="CA">加拿大</option>';
			html+='<option  value="GB">英国</option>';
			html+='<option  value="ID">印度尼西亚</option>';
			html+='<option  value="TH">泰国</option>';
			html+='<option  value="BR">巴西</option>';
			html+='</select></div></div>';
			html+='<div class="row"><p style="font-weight:bold;color:#333;">广告ID</p><div class="input-field col s6"><input id="val" name="describe" type="text" value="'+val+'" class="form-control validate"></div></div>';
            html+='<div class="row"><p style="font-weight:bold;color:#333;">排序</p><div class="input-field col s6"><input id="remark" name="remark" type="text" value="'+remark+'" class="form-control validate"></div></div>';			
			html+='<input class="waves-effect waves-light btn save" type="submit" style="background-color:orange;margin-top:20px;width:140px;" value="修改"></input> </form>';
	   
		    //自定页
			layer.open({
			  type: 1,
			  skin: 'layui-layer-rim', //加上边框
			  area: ['500px', '400px'], //宽高
			  content: html
			});
			$("#aaxx").find("option[value="+code+"]").attr("selected",true);
			
			$(".save").click( function(){
			  
			       code = $("#aaxx").val();
				   val = $("#val").val();
				   remark = $("#remark").val();
				    if( code=="country" ||  val=="" )
				   {
				      layer.msg('国家,广告ID不能为空');
					  return false;
				   }
				   layer.load(0, {shade: false});
				   $(this).attr("disabled",true);
			   $.post("/admin_advertisement/country_edit",{id:id,prop_value_one:code,prop_value_two:val,cfid:cfid,remark:remark},function(e){
			       $(".save").attr("disabled",false);
			      if("ok"==e)
				     {						
						window.location.reload();
						layer.closeAll();
					 }else{
					   layer.msg('修改失败');
					 }
			   })
			  
			   return false;
			})
	    event.stopPropagation();
	});	
  });
	</script>
</body>

</html>
