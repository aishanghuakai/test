<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title></title>
	{include file="./static/html/header_common.html" /}
	<link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" media="all" href="/static/css/select.css" />
    <style>
	li{
	   padding: 5px 0;
list-style: none;
 
font-size: 12px;
	}
	li.alone{
	  padding-top:20px;
	
	}
	 li .avatar {
    height: 50px;
    width: 50px;
    float: left;
    margin: 3px 15px 0px 10px;
    border: none;
    border-radius: 50%;
}
img {
    vertical-align: middle;
}
.date-picker {
    cursor: pointer;
	float:right;
	padding-right:20px;
	color: #999;
}
.edit,.delete,.rr,.attr{
   cursor: pointer;
}
form .row{
  margin-left:30px;
  margin-bottom:0px;
  margin-right:30px;
  margin-top:5px;
}
.row .col.s6 {
    width: 100%;
    margin-left: auto;
    left: auto;
    right: auto;
}
.row input{
  margin:0 0;
  padding:0 0;
}
.alert {
    padding: 0px;
    margin-bottom: 0px;
    border: 1px solid transparent;
        border-top-color: transparent;
        border-right-color: transparent;
        border-bottom-color: transparent;
        border-left-color: transparent;
    border-radius: 4px;
}
	</style>	
</head>
<body>
    <div id="wrapper">
        {include file="./static/html/header.html" /} 
		
	   <!--/. NAV TOP  -->
         {include file="./static/html/side.html" /} 
        <!-- /. NAV SIDE  -->
        <div id="page-wrapper">
		   <div class="header"> 
			<h1 class="page-header">
				广告配置
			</h1>
			<h1  style="float:right;margin-right:15px;color:#ccc;">
				#{$list->total()}
			</h1>
			<ol class="breadcrumb">
			  <li><a href="#">主页</a></li>
			  <li><a href="/admin_advertisement/lists?type=1">广告管理</a></li>
			   <li><a href="/admin_advertisement/lists?type=1">adc工程</a></li>
			   <li><a href="#"><span style="font-size:14px;color:red;">{$app_name}</span>应用</a></li>
			  <li class="active">广告列表</li>
			</ol> 									
		</div> 
            <div id="page-inner"> 
			     <div class="row">
                <div class="col-md-12">
                     <!--    Hover Rows  -->
                    <div class="card">
                        <div class="card-action">
                         <div style="float:left;margin-right:20px;" class="rr"><a style="color: #999;font-weight: normal;" onclick="window.history.go(-1);">返回</a></div>
                         <div style="float:left;">
							 <p style="line-height: 0px;">
							 <input name="type" {eq name="adtype" value="all"} checked {/eq} id="test2" value="all" type="radio">
							  <label for="test2">全部</label>
							  <input name="type" {eq name="adtype" value="nat"} checked {/eq} id="test4" value="nat" type="radio">
							  <label for="test4">原生</label>
							   <input name="type" {eq name="adtype" value="rew"} checked {/eq} id="test5" value="rew" type="radio">
							  <label for="test5">激励视频</label>
							  <input name="type" {eq name="adtype" value="int"} checked {/eq} id="test1" value="int" type="radio">
							  <label for="test1">插屏</label>
							</p>
						</div>
						 <div class="select_zyd1"  style="float:left;margin-left:20px;">
								<p>
								<select class="form-control" id="selectcountry">
								  <option value="country">选择国家</option>
                                  <option value="all">全部</option>								  
								  <option  value="US">美国</option>
								  <option  value="TW">台湾</option>
								  <option  value="HK">香港</option>
								  <option  value="JP">日本</option>
								  <option value="KR">韩国</option>
                                  <option  value="DE">德国</option>
								  <option value="FR">法国</option>
                                  <option value="CN">中国</option>								  
								</select>
								</p>
						 </div>
						<!-- <div style="float:right;margin-top:-18px;margin-right:-10px;">#{$list->total()}</div>	 -->
						 <div style="float:right;" id="add"><a class="btn-floating" style="background-color:#2ec376"><i class="material-icons">add</i></a></div>				   
                        </div>
						<div>					
				     </div>
                        <div class="card-content" style="padding: 5px 20px 20px 20px;clear:both;">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                             <th style="vertical-align:middle; text-align:center;">序号</th>
                                             <th style="vertical-align:middle; text-align:center;">广告名称</th>
                                             <th style="vertical-align:middle; text-align:center;">广告ID</th>
											 <th style="vertical-align:middle; text-align:center;">广告类型</th>
											 <th style="vertical-align:middle; text-align:center;">广告排序</th>
                                            <!--  <th style="vertical-align:middle; text-align:center;">备注</th> -->
									         <th style="vertical-align:middle; text-align:center;">状态</th>
											 <th style="vertical-align:middle; text-align:center;">修改人</th>
									         <th style="vertical-align:middle; text-align:center;">修改时间</th>
											 <th style="vertical-align:middle; text-align:center;">操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
									    {volist name="list" id="item"}
                                        <tr class="dt" onclick="he_location({$item.id});">
                                            <td class="dd" style="vertical-align:middle; text-align:center;"><?php $p=isset($_GET["page"])?$_GET["page"]:1; echo ($p-1)*20+$key+1; ?></td>
                                           
                                             <td class="dd" style="vertical-align:middle; text-align:center;">{$item.name}</td>
                                             <td class="dd" style="vertical-align:middle; text-align:center;">{$item.val}</td>
											 
											 <td class="dd" style="vertical-align:middle; text-align:center;">
											 {if condition="$item['adtype'] eq 'int'"}<div class="alert alert-success">插屏</div>
											{elseif condition="$item['adtype'] eq 'rew'"/}<div class="alert alert-info">激励视频</div>
											{elseif condition="$item['adtype'] eq 'nat'"/}<div class="alert alert-warning">原生</div>
											{elseif condition="$item['adtype'] eq 'native'"/}<div class="alert alert-warning">原生</div>
											{elseif condition="$item['adtype'] eq 'ban'"/}<div class="alert alert-danger">banner</div>
											{/if}
											
											 </td>
                                            <td class="dd" style="vertical-align:middle; text-align:center;">{$item.adsort}</td>
											<!--  <td class="dd" style="vertical-align:middle; text-align:center;font-style:italic;">{$item.desc}</td> -->
											  <td class="dd" style="vertical-align:middle; text-align:center;font-style:italic;">
											  {if condition="$item['status'] eq '1'"}
											  <i class="badge" style="background-color:#2ec376">active</i>
											  {else /}
											   <i class="badge">ban</i>
											  {/if}
											  </td>
											 <td class="dd" style="vertical-align:middle; text-align:center;">{$item.updateuser}</td>
											 <td class="dd" style="vertical-align:middle; text-align:center;font-style:italic;">{$item.updatetime|getadvertime}</td>
											 <td style="vertical-align:middle; text-align:center;" ><i data-id="{$item.id}" data-status="{$item.status}" data-name="{$item.name}" data-val="{$item.val}" data-desc="{$item.desc}" data-adsort="{$item.adsort}" title="修改" class="material-icons dp48 edit">mode_edit</i>&nbsp;&nbsp;<i class="material-icons dp48 attr" data-id="{$item.id}">library_add</i>&nbsp;&nbsp;<i class="fa fa-close fa-lg delete" title="删除" data-id="{$item.id}" style="vertical-align:25%;color:red;"></i></td>                                           
                                        </tr>
                                        {/volist}
                                    </tbody>
                                </table>
                                 <div>{$list->render()}</div>								
                            </div>
														
                        </div>
                    </div>
                    <!-- End  Hover Rows  -->
                </div>
                <div id="topp"  style="position:fixed;color:red;top:2%;left:25%;z-index:1000;font-size:25px;display:none;">{$app_name}应用</div>
            </div>		
         <!-- /. PAGE WRAPPER  -->
        </div>
     <!-- /. WRAPPER  -->
   {include file="./static/html/footer_common.html" /}
  <!-- Morris Chart Js -->
   <script src="/static/assets/js/jquery-1.10.2.js"></script>
	
	<!-- Bootstrap Js -->
    
	 <script src="/static/js/layer/layer.js"></script>
    <script>
	  $(function () {
	      
	       $("input[name='type']").click( function(){
            window.location.href="/admin_advertisement/adlist?type=<?php echo $type; ?>&id=<?php echo $appid; ?>&adtype="+$(this).val();
         } );
		 
		 $(window).scroll(function(){
		        var scroll =$(window).scrollTop();
				if(scroll > 100){
					$("#topp").show('slow');
				}else{
					$("#topp").hide('slow');
				}
			})
		 
		 $("#selectcountry").change( function(){
		     var code = $(this).val();
			 if("country"==code)
			 {
			    return false;
			 }
			 var adtype = $("input[name='type']:checked").val();
			 window.location.href="/admin_advertisement/getcountrylist?type=<?php echo $type; ?>&id=<?php echo $appid; ?>&adtype="+adtype+"&code="+code;
		 })
   
	       $(".delete").click( function(event){
		        var id = $(this).attr("data-id");
				var _$ = $(this);
		        layer.confirm('确认删除后数据将不会保存?', {
					  btn: ['确认','取消'] //按钮
					}, function(){
					  var index = layer.load(1, {
								  shade: [0.1,'#fff'] //0.1透明度的白色背景
								});
					   $.post("/admin_advertisement/ad_delete",{id:id},function(e){
					       layer.closeAll();
					         if("ok"==e)
							 {
							    _$.parents("tr").remove();
								layer.msg('删除成功');								
							 }else{
							   layer.msg('网络异常,删除失败', {icon: 1});
							 }
					   })
					 
					}, function(){
					  
					});
			   return false;
		   });
		   
		   $("#add").bind('click',function(){
		    
	    var html='<form  style="text-align:center;">';
		    html+=' <div class="row"><p style="font-weight:bold;color:#333;">广告名称<i style="color:red;font-size:10px;">*</i></p><div class="input-field col s6"><input  id="name" name="username" value="" type="text" class="validate"></div></div>';
			html+='<div class="row"><p style="font-weight:bold;color:#333;">广告ID<i style="color:red;font-size:10px;">*</i></p><div class="input-field col s6"><input id="val" name="describe" type="text" value="" class="validate"></div></div>';
						
			html+='<div class="row"><p style="font-weight:bold;color:#333;">广告类型设置<i style="color:red;font-size:10px;">*</i></p><p><input name="adtype" type="radio"  id="test6" value="nat" /><label for="test6">原生</label><input name="adtype"  type="radio" id="test7" value="int" /> <label for="test7">插屏</label><input name="adtype"  type="radio" id="test8" value="rew" /> <label for="test8">激励视频</label><input name="adtype"  type="radio" id="test9" value="ban" /> <label for="test9">banner</label></p></div>';
			html+='<div class="row"><p style="font-weight:bold;color:#333;">广告排序</p><div class="input-field col s6"><input name="describe" type="text" value="" id="adsort" class="validate"></div></div>';
		   html+='<div class="row"><p style="font-weight:bold;color:#333;">备注</p><div class="input-field col s6"><input name="describe" type="text" value="" id="desc" class="validate"></div></div>';	
			html+='<input class="waves-effect waves-light btn add" type="submit" style="background-color: #ed4040;margin-top:20px;width:140px;" value="增加"></input></form>';
			 //自定页
			layer.open({
			  type: 1,
			  skin: 'layui-layer-rim', //加上边框
			  area: ['650px', '550px'], //宽高
			  content: html
			});
			$(".add").click( function(){
			  
			       var name = $("#name").val();
				   var val = $("#val").val();
				   var desc = $("#desc").val();
				   var adsort = $("#adsort").val();
				    if( name=="" ||  val=="" )
				   {
				      layer.msg('广告名称,广告ID不能为空');
					  return false;
				   }
				   
                   if(!$("input[name='adtype']").is(":checked"))
                      {
					    layer.msg('请选择广告类型');return false;
					  }				   
				   var adtype = $("input[name='adtype']:checked").val();
				   var appid = '<?php echo $appid; ?>';
				   layer.load(0, {shade: false});
				   $(this).attr("disabled",true);
			   $.post("/admin_advertisement/ad_add",{name:name,val:val,desc:desc,adtype:adtype,adsort:adsort,appid:appid,app_class:1},function(e){
			       $(".add").attr("disabled",false);
			      if("ok"==e)
				     {					    
						
						window.location.reload();
						layer.closeAll();
					 }else{
					   layer.msg('添加失败');
					 }
			   })
			  
			   return false;
			})
	    event.stopPropagation();
	});
		   
		});
       				
	   $(".edit").click( function(event){
	    var _$ = $(this);
		var id = _$.attr("data-id");
		var name = _$.attr("data-name");
		var val = _$.attr("data-val");
		var desc = _$.attr("data-desc");
		var adsort = _$.attr("data-adsort");
		var status = _$.attr("data-status");
	    var html='<form  style="text-align:center;">';
		    html+=' <div class="row"><p style="font-weight:bold;color:#333;">广告名称</p><div class="input-field col s6"><input  id="name" name="username" value="'+name+'" type="text" class="validate"></div></div>';
			html+='<div class="row"><p style="font-weight:bold;color:#333;">广告ID</p><div class="input-field col s6"><input id="val" name="describe" type="text" value="'+val+'" class="validate"></div></div>';
			html+='<div class="row"><p style="font-weight:bold;color:#333;">广告排序</p><div class="input-field col s6"><input name="describe" type="text" value="'+adsort+'" id="adsort" class="validate"></div></div>';
			html+='<div class="row"><p style="font-weight:bold;color:#333;">备注</p><div class="input-field col s6"><input name="describe" type="text" value="'+desc+'" id="desc" class="validate"></div></div>';
			if( status==1 )
			{
			  html+='<div class="row"><p style="font-weight:bold;color:#333;">状态显示</p><p><input name="status" checked type="radio"  id="test11" value="1" /><label for="test11">显示</label><input name="status"  type="radio" id="test12" value="0" /> <label for="test12">禁用</label></p></div>';
			}else{
			 html+='<div class="row"><p style="font-weight:bold;color:#333;">状态显示</p><p><input name="status" type="radio"  id="test11" value="1" /><label for="test11">显示</label><input name="status" checked type="radio" id="test12" value="0" /> <label for="test12">禁用</label></p></div>';
			}
			
			html+='<input class="waves-effect waves-light btn save" type="submit" style="background-color: #2ec376;margin-top:20px;width:140px;" value="修改"></input> </form>';
	   
		    //自定页
			layer.open({
			  type: 1,
			  skin: 'layui-layer-rim', //加上边框
			  area: ['650px', '540px'], //宽高
			  content: html
			});
			$(".save").click( function(){
			  
			       name = $("#name").val();
				   val = $("#val").val();
				   desc = $("#desc").val();
				   adsort = $("#adsort").val();
				   status = $("input[name='status']:checked").val();
				    if( name=="" )
				   {
				      layer.msg('广告名称,广告ID不能为空');
					  return false;
				   }
				   layer.load(0, {shade: false});
				   $(this).attr("disabled",true);
			   $.post("/admin_advertisement/ad_edit",{id:id,name:name,val:val,desc:desc,adsort:adsort,status:status},function(e){
			       $(".save").attr("disabled",false);
			      if("ok"==e)
				     {					    
						
						window.location.reload();
						layer.closeAll();
					 }else{
					   layer.msg('修改失败');
					 }
			   })
			  
			   return false;
			})
	    event.stopPropagation();
	});	
	
	 $(".attr").click( function(event){
	    
	      var html="";
		  var id = $(this).attr("data-id");
		  layer.load(0, {shade: false});
	      $.get("/admin_advertisement/attr",{id:id},function(e){
		    layer.closeAll();
		      html = e;
			 //自定页
				layer.open({
				  type: 1,
				  skin: 'layui-layer-rim', //加上边框
				  area: ['600px', '370px'], //宽高
				  content: html
				});
		  });
		    
			
	    event.stopPropagation();
	});	
	var deletemy = function(e)
	{
	   $(e).parents("div.row").remove();
	}
	var attr_save = function(e)
	{
	   var index = layer.load(0, {shade: false});
	   $(e).attr("disabled",true);
	   var data = $(".attr_form").serialize();
	   $.post("/admin_advertisement/attr_save",data,function(r){
	      layer.closeAll();
		   $(e).attr("disabled",false);
	           if("ok"==r)
				     {						
						layer.msg('保存成功');
					 }else{
					   layer.msg('保存失败');
					 }
	   })
	   return false;
	}
	</script>
</body>

</html>
