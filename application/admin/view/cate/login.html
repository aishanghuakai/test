<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GAME BRAIN</title>
    <link type="favicon" rel="icon" href="/favicon.ico?t=344">
	<link href="/static/css/login.css?t=<?php echo time(); ?>" rel="stylesheet" type="text/css" />
	<link href="/static/css/font-awesome.min.css" type="text/css" rel="stylesheet">
	<script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
	<!-- import Vue.js -->
<script src="/static/js/vue.min.js"></script>
<!-- import stylesheet -->
<link rel="stylesheet" type="text/css" href="http://unpkg.com/iview/dist/styles/iview.css">
<!-- import iView -->
<script src="/static/js/iview.min.js"></script>
    <style>
	   .login .inputtxt:hover {
        border-color: #0f88eb;
      }
	  .hw_logo img{margin-top:5px;height:60px;}
	</style>	
</head>
 
<body style="background:#f6f6f6 url(/static/images/bg.png);">
    <div id="wrapper">
       <nav class="navbar  top-navbar" style="">
			  <div class="hw_logo">
				<a class="navbar-brand" href="javascript:;"><img src="/static/images/logo.png"></a>
			  </div>        	  
        </nav>
        <div class="main_desc">
		   <h1>数据驱动决策</h1>
		   <p>数据化驱动不仅仅是一种信息化体验,更是完全集成和可预测的体验</p>
		</div>		
		<div  style="width:100%;margin-top:60px;text-align:center">
		    <div class="login">
                <div>
                        <form  action="/admin_cate/accountlogin" method="post" >						
							<div class="title">欢迎登录</div>
							<div class="line"><input class="inputtxt" value="" name="username"  placeholder="账号" type="text"></div>
							<div class="line"><input class="inputtxt" name="passwd"  placeholder="密码" type="password"></div>
							<!-- <div  id="verify" style="margin:15px 0px;">
                            </div> -->
							<div class="Verity">
							  <div id="TencentCaptcha" data-appid="2094094724" data-cbfn="callback" class="TCaptcha-button ready">							   
							     <div class="TCaptcha-icon"><i></i></div>
							    <span>点击按钮进行验证</span>
							  </div>
							  <div id="TencentCaptcha" class="verify_success">
							    <span><i class="fa fa-check-circle"></i>&nbsp;验证成功</span>
							  </div>
							</div>
							<div class="login_btn">
							 <input id="login-button" value="登录" type="button">
							</div>
                            <div style="text-align:right;margin-top:6px;height:0px;"><Checkbox v-model="remember">记住密码,七天免登录</Checkbox></div>
                        </form>
                </div>              
            </div>
           	 
    <!-- <Modal v-model="repairShow" title="修改密码">
        <i-form :model="formData">
			<FormItem label="Text">
			   <h5 style="padding:5px 15px 15px 5px;font-weight:700">旧密码</h5>
			   <i-input v-model="formData.oldpassword" style="width:200px;" type="password"></i-input>
			 </FormItem>
			 <FormItem label="Text">
			  <h5 style="padding:15px 15px 15px 5px;font-weight:700">新密码</h5>
			    <i-input v-model="formData.newpassword" style="width:200px;" type="password"></i-input>
				<span> 新密码长度不能太过简单,字母和数字组成</span>
			 </FormItem>
        </i-form>						 
		<div slot="footer"> 
		  <i-button type="text" size="large" @click="repairShow=false">取消</i-button> 
		  <i-button type="primary" size="large" @click="repair">确定</i-button> 
		</div>
    </Modal>			 --> 
            				
		</div>
	</div>	
</body>
<script src="/static/js/jquery-2.1.4.min.js"></script>
<script src="/static/js/plug-in.min.js"></script>
<script src="/static/js/layer/layer.js"></script>

<script>

  var _t = new Vue({
        el: '#wrapper',
        data: {
		   repairShow:false,
		   remember:1,
		   formData:{
		     oldpassword:"",
			 newpassword:""
		   }
		},
		methods:{		  
		  repair:function(){		     
			 var username = $("input[name='username']").val();
			 this.formData.username = username
			 if( this.formData.oldpassword==this.formData.newpassword )
			 {
			    _t.$Message.error("密码不能与之前密码一样!");
				return false;
			 }
			 if( this.formData.newpassword.length<6 )
			 {
			    _t.$Message.error("新密码长度至少为6为以上!");
				return false;
			 }
			 var reg = /^[^\d]*$|^[^a-zA-Z]*$|[^\da-zA-Z]/
			 if (reg.test(this.formData.newpassword)) {
				_t.$Message.error("新密码必需由数字和字母两部分组成");
				return false;
			}
			 var index = layer.load();
			 $.post('/admin_cate/repair',this.formData,function(result){
			     layer.close(index);				 
                if( result=="fail" )
				{
				    _t.$Message.error("信息填写不完整或密码错误!");
					return false;
				}else if( result=="ok" )
				{
				    _t.repairShow  = false
					_t.$Message.success('修改成功，正在跳转...');			
			        window.location.href="/admin_index/main";
				}               		
			 })			 
		  }
		}
    })
  
  var checkVerify = false;  
  window.callback = function(res){

    // res（用户主动关闭验证码）= {ret: 2, ticket: null}
    // res（验证成功） = {ret: 0, ticket: "String", randstr: "String"}
    if(res.ret === 0){
		$(".ready").hide();
		$(".verify_success").show();
        checkVerify = true;		
    }
}
  
  var isnewhost ="{$isnewhost}";
  $( function(){
     
     $("#login-button").click( function(){
	 var url = $("form").attr("action");
	 var username = $("input[name='username']").val();
     var passwd = $("input[name='passwd']").val();
	 var remember = $("input[type='checkbox']").is(':checked')?1:0;
	 if( !checkVerify )
		{
		    _t.$Message.warning('验证失败，请重新验证');return false;
		}
	    $(this).attr("disabled",true);
		var index = layer.load();
        $.post(url,{passwd:passwd,username:username,remember:remember},function(result){
		   $("#login-button").attr("disabled",false);
		   layer.close(index);
			if(result =="ok"){	
                 _t.$Message.success('登陆成功，正在跳转...');			
			     window.location.href="/admin_index/main"; 		 
		       }else if(result=="repair"){
			      _t.$Modal.confirm({
                    title: '系统提示',
                    content: '<p>您的账号暂无法登录，请您联系管理员！</p>',
					okText: '确定',
                    onOk: () => {
                        _t.repairShow = true
                    }
                });
			   }
			else{
			     _t.$Message.error("账号密码不匹配,请重新输入");
			 }
		  });	 
		 return false;
	 })
  })
</script>
</html>