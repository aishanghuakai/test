<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GAME BRAIN</title>
    {include file="./static/html/header_common.html" /}  
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
   <script src="https://unpkg.com/vue/dist/vue.js"></script>
  <!-- import JavaScript -->
  <script src="https://unpkg.com/element-ui/lib/index.js"></script>
  <script src="/static/js/axios.min.js"></script>	 
	<style>
	  .cell{font-size:12px;}
	  .el-table td, .el-table th {
    padding:9px 0;}
	  .item {
		  margin-top: 10px;
		  margin-right: 40px;
		}
      .grid-content{
	    background: #fff;
		padding: 15px !important;
		box-shadow: 0 1px 15px 1px rgba(69,65,78,.08);
		border-radius:10px;
		border: 0;
		text-align:center;
	  }	
       .card-category{
	   font-size: 13px;
	   color:#444;
	   margin-bottom: 0;}
	   .card-title{
	    color:#575962;
		font-size: 18px;
		font-weight: 400;
	   }
	   .page-title {
		font-size:16px;
		font-weight: 600;
		color:#444;
		
		}
		.count {
    background:#4285f4;
    display: inline-block;
    padding:7px 1px;
    margin-right: 5px;
}
	  .el-badge__content.is-fixed{position:relative !important;}	
	</style>
</head>
<body style="background:#f9fbfd;">
    <div id="wrapper" style="background-color:#f9fbfd;">
        {include file="./static/html/header.html" /}	
		<div class="hw_page_content" style="background-color:#f9fbfd;">
		    <div class="hw_menu_left">
             {include file="./static/html/side.html" /}  
			</div>
		    <div class="hw_content_right" style="padding:20px 5px;background: #f9fbfd;">
			            <div class="main" style="margin-bottom:10px;">
						    
                            <h4 class="page-title">
							<el-page-header @back="goBack" content="渠道汇率设置" style="float:left;"></el-page-header></h4>
							<el-button size="small" style="float:right;margin-right:5%;" @click="openModel" type="primary">+汇率</el-button>
							<div class="clear" style="clear:both;"></div>
							<p style="margin-top:40px;color:red;font-size:12px;">1,Facebook默认1.000，Admob默认0.920。
							</br>
							2,其他渠道默认为1
							</br>
							3,人民币渠道需要换成美元比例
							</p>
							<div >
							    <el-tabs v-model="channel" type="card" @tab-click="handleClick">
								<el-tab-pane label="Facebook" name="6"></el-tab-pane>
								<el-tab-pane label="Admob" name="5"></el-tab-pane>
								<el-tab-pane label="Vungle" name="4"></el-tab-pane>
								<el-tab-pane label="Ironsource" name="7"></el-tab-pane>
								<el-tab-pane label="Unity" name="2"></el-tab-pane>
								<el-tab-pane label="Applovin" name="3"></el-tab-pane>
								<el-tab-pane label="Mintegral" name="1"></el-tab-pane>
								<el-tab-pane label="Tiktok" name="36"></el-tab-pane>
								<el-tab-pane label="人民币" name="cny"></el-tab-pane>
							  </el-tabs>
							</div>			
							 <el-table
								:data="tableData"
								v-loading="loading"
								height="500"
								style="width: 100%;">								
								<el-table-column prop="month"  align="center" label="月份"></el-table-column>								
								<el-table-column prop="val" align="center" label="汇率"></el-table-column>
								<el-table-column align="center" label="适用类型">
								  <template slot-scope="scope">
								    <el-tag type="danger" size="small" effect="plain">{{scope.row.is_default==1?'全部':'单独'}}</el-tag>
								  </template>
								</el-table-column>
								<el-table-column align="center" label="操作">
								  <template slot-scope="scope">
								    <el-button type="text" @click="edit(scope.row)" size="small">编辑</el-button>
								  </template>
								</el-table-column>
							</el-table>

			  </div>
			  
			  <el-dialog title="汇率设置" :visible.sync="dialogFormVisible">
				  <el-form :model="form">
					<el-form-item label="选择月份" :label-width="formLabelWidth">
					  <el-date-picker
						  v-model="form.month"
						  type="month"
						  :disabled ="disabled"
						  value-format="yyyy-MM"
						  placeholder="选择月">
					  </el-date-picker>
					</el-form-item>
					<el-form-item label="输入汇率" :label-width="formLabelWidth">
					  <el-input v-model="form.val"  style="width:220px;" autocomplete="off"></el-input>
					  <span style="font-size:12px;color:red;">* 汇率为小数点，不是百分比</span>
					</el-form-item>
					<el-form-item label="适用类型" :label-width="formLabelWidth">
					  <el-checkbox v-model="form.is_default" :true-label="1" :false-label="0">是否适用全部产品</el-checkbox>
					</el-form-item>
				  </el-form>
				  <div slot="footer" class="dialog-footer">
					<el-button @click="dialogFormVisible = false">取 消</el-button>
					<el-button type="primary" @click="confirm">确 定</el-button>
				  </div>
				</el-dialog>
			  
			</div>
		</div>
		 {include file="./static/html/footer.html" /}
	</div>
</body>
 {include file="./static/html/footer_common.html" /}
  <script>
    
    let t = new Vue({
        el: '#wrapper',
        data: {
			loading: false,
			formLabelWidth:'120px',
			dialogFormVisible:false,
			form:{},
			channel:'6',
			disabled:false,
			date:[],
			tableData: []	
        },
		computed:{
		},
		watch:{
		  channel(){
		    this.getlist()
		  }
		},
		created(){
		 
		},
        methods: {           
		   goBack() {
		     window.location.href='/admin_index/revenue';
		   },
		   openModel(){
		    this.dialogFormVisible = true
			this.disabled = false
			this.form ={}
		   },
		   edit(row){
		    this.form = row
			this.disabled = true
			this.dialogFormVisible = true
		   },
		   confirm(){
			if(!this.form.month || !this.form.val)
			{
			  this.$message.error('请填写完整信息');
			  return false;
			}
			this.form.channel = this.channel
			this.form.app_id = '{$appid}',
			axios({
					method: 'post',
					url:'/admin_rate/add_rate',
					data:this.form
				}).then(res=>{			
				 if(res.data =="ok")
				 {
				   this.$message.success('操作成功!');
				   this.dialogFormVisible = false
				   this.getlist()
				 }
			 })
		   },
		   handleInstallDate(){
			this.getlist()
		   },
		   handleChange(){
			 this.getlist()
		   },
			getlist(){
			   let params ={
			      channel:this.channel,
				  appid:'{$appid}'
			   }
			   let _that = this
			   this.loading = true
			   axios({
					method: 'post',
					url:'/admin_rate/rate_json',
					data:params
				}).then(res=>{			
				 _that.loading = false
				 this.tableData = res.data
			 })
			}
        },
		mounted(){
		  this.getlist()
		}
    })
  </script>
</html>