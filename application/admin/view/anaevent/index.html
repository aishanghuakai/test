<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GAME BRAIN</title>
    {include file="./static/html/header_common.html" /}
	<link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
   <script src="https://unpkg.com/vue/dist/vue.js"></script>
  <!-- import JavaScript -->
  <script src="https://unpkg.com/element-ui/lib/index.js"></script>
  <script src="/static/js/axios.min.js"></script>	 
    <style>	
	.el-tag + .el-tag {
    margin-left: 10px;
  }
  .button-new-tag {
    margin-left: 10px;
    height: 32px;
    line-height: 30px;
    padding-top: 0;
    padding-bottom: 0;
  }
  .input-new-tag {
    width: 90px;
    margin-left: 10px;
    vertical-align: bottom;
  }
  .cell{font-size:12px;}
  .el-table td, .el-table th {
    padding:9px 0;}
	</style>	
</head>
<body style="background-color:#fff;">
    <div id="wrapper" style="background-color:#fff;">
        {include file="./static/html/header.html" /}	
		<div class="hw_page_content">
		    <div class="hw_menu_left">
         {include file="./static/html/side.html" /}  
			</div>
		    <div class="hw_content_right" style="width:100%;">
			      
                	<div style="margin-top: 20px">
						  			           
					   <el-form  size="small"  class="demo-form-inline">
						  
						   <el-form-item label="设定日期">
							<el-date-picker v-model="date" value-format="yyyy-MM-dd" type="daterange" range-separator="-" style="width:240px;" start-placeholder="开始日期" end-placeholder="结束日期">
							</el-date-picker>
                            <el-select v-model="country" placeholder="选择国家" >
							  {volist name="countrys" id="item"}
							   <el-option label="{$item}" value="{$key}"></el-option>
							  {/volist}
							</el-select>							
						   </el-form-item>
                          <el-form-item label="计数关键字">
							   <el-tag :key="tag" v-for="tag in dynamicTags" closable :disable-transitions="false" @close="handleClose(tag)">
								  {{tag}}
								</el-tag>
								<el-input class="input-new-tag" v-show="inputVisible" v-model="inputValue" ref="saveTagInput"size="small" @keyup.enter.native="handleInputConfirm" @blur="handleInputConfirm">
						        </el-input>
								<el-button  @click="showInput">+添加关键字</el-button>
						   </el-form-item>							   
						  <el-form-item label="用户周期">
							<el-select v-model="day" >
							  <el-option label="近三天" value="3"></el-option>
							  <el-option label="近7天" value="7"></el-option>
							  <el-option label="近10天" value="10"></el-option>
							</el-select>
							<el-button :type="buttonStyle1" @click="handselect(1)">按留存查询</el-button>
							<el-button :type="buttonStyle2" @click="handselect(2)">按变现查询</el-button>
						  </el-form-item>						   
						</el-form>						
					</div>					
					<div>
					<el-table v-loading="loading" :data="tableData" style="width: 100%">
					  
					    <template v-for="(item,index) in schema" >
						   <el-table-column v-if="item.value!='category'" :key="item.value" :prop="item.value" :label="item.label" align="center"></el-table-column>
							<el-table-column v-else :key="item.value" :prop="item.value" :label="item.label" align="center">
								<template slot-scope="scope">
								  <el-button @click.native.prevent="download(scope.row.i)" type="text" size="small">
								   导出用户
								  </el-button>
                                </template>								
					        </el-table-column>
					  </template>
					</el-table>
				  </div>	
			</div>
		</div>
		 {include file="./static/html/footer.html" /}
	</div>	
</body>
 {include file="./static/html/footer_common.html" /}

 <script>
        new Vue({
        el: '#wrapper',
        data: {
            loading:false,
			keyword:'',
			country:'all',
			selecttype:"2",
			buttonStyle1:"",
			buttonStyle2:'primary',
			date:['{$start}','{$end}'],
			day:'3',
			dynamicTags: [],
			schema:[],
			tableData: [],
            inputVisible: false,
            inputValue: ''
        },
		watch: {
		 
		},
		created(){
		  this.getlist()
		},
        methods: {
           handleClose(tag) {
			this.dynamicTags.splice(this.dynamicTags.indexOf(tag), 1);
		  },
		  showInput() {
			this.inputVisible = true;
			this.$nextTick(_ => {
			  this.$refs.saveTagInput.$refs.input.focus();
			});
		  },
		  download(i){
		    window.location.href='/ad_event/download?i='+i+"&country="+this.country+"&start="+this.date[0]+"&end="+this.date[1]+"&filter="+this.dynamicTags
		  },
		  handselect(type)
		  {		    
			if( type=="1" )
			{
			  this.buttonStyle1="primary"
			  this.buttonStyle2=''
			}else{
			  this.buttonStyle2="primary"
			  this.buttonStyle1=''
			}			
			this.selecttype = type
			this.getlist()
		  },
		  handleInputConfirm() {
			let inputValue = this.inputValue;
			if (inputValue) {
			  this.dynamicTags.push(inputValue);
			}
			this.inputVisible = false;
			this.inputValue = '';
		  },
		  getlist(){
			this.loading = true
			let _that = this
			axios({
					method: 'post',
					url:'/ad_event/json_data',
					data:{ date:this.date,day:this.day,filter:this.dynamicTags,country:this.country,selecttype:this.selecttype}
					}).then(res=>{			
					 _that.loading = false
					 this.tableData = res.data.output
					 this.schema = res.data.schema
					 
				 })
		  }
		}
    })
 </script>
</html>