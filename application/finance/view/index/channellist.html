<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GAME BRAIN</title>
    {include file="./static/html/fheader_common.html" /}
	<link rel="stylesheet" type="text/css" href="/static/css/goalset.css">
	<style>
	.demo-drawer-footer{
        width: 100%;
        position: absolute;
        bottom: 0;
        left: 0;
        border-top: 1px solid #e8e8e8;
        padding: 10px 16px;
        text-align: right;
        background: #fff;
    }
	.box{
	 border:none;
	 -webkit-box-shadow: 0 0;
     box-shadow:0 0;
	}
	.table>thead>tr>td, .table>thead>tr>th {
       padding: 8px;}
	</style>
</head>
<body>
    <div id="wrapper">
        {include file="./static/html/fheader.html" /}	
		<div class="hw_page_content">
		    <div class="hw_menu_left">
         {include file="./static/html/fside.html" /}  
			</div>
		    <div class="hw_content_right">
			   
			   
				  <div class="box" style="margin-top:10px;">
						<div class="box-header with-border">
						  <i-button type="primary" style="float:right;"  icon="ios-add" @click="openModal">添加渠道</i-button>
						  <i-select v-model="id" clearable filterable @on-change="filterChannel"  style="float:right;width:200px;margin-right:10px;">
						    {volist name="alllist" id="item"}
							 <i-option  value="{$item.id}" key="{$item.id}">{$item.name}</i-option >
                           {/volist}							
                        </i-select>
						  <button-group shape="circle">
							<i-button to="/finance/channellist?type=1"  <?php $info =getuserinfo();if( $info["ad_role"]=="advertiser" )  echo "disabled"; ?> type="{if condition="$type eq '1'"}primary{/if}">收款渠道</i-button>
							<i-button to="/finance/channellist?type=2" <?php $info =getuserinfo();if( $info["id"]=="6" )  echo "disabled"; ?> type="{if condition="$type eq '2'"}primary{/if}">付款渠道</i-button>
						</button-grou>
						
						</div>
						<div class="box-body">
							<div class="table-responsive">
							  <table class="table">
								<tbody>
								    
									<tr class="tr_header">									 
									  
									  <th>序号</th>	
									  <th>渠道名称</th>								
									  <th>类型</th>
									  <th>货币</th>
									  <th>备注</th>
									  <th>编辑者</th>								
									  <th>编辑时间</th>									  
									  <th>操作</th>
									</tr>
									 {volist name="list" id="item"}
									<tr>
									 
									  <td><?php $p = isset($_GET["page"])?$_GET["page"]:1;echo (($p-1))*50+$key+1;  ?></td>
									  <td>{$item.name}</td>						
									  <td>									    
											 {if condition="$item['type'] eq '1'"}收款
											   {elseif condition="$item['type'] eq '2'"/}付款
											   {elseif condition="$item['status'] eq '3'"/}其他
											{/if}
									  </td>
									  <td>{$item.currency}</td>
                                      <td>{$item.desc}</td>
                                      <td>{$item.updateuser}</td>									  
									  <td>{$item.updatetime|getadvertime}</td>
									   <td><a @click="editChannel({$item.id})"  href="javascript:;">编辑</a></td>
									</tr>
									 {/volist}
								  </tbody>
								</table>
								 
							</div>
						</div>
				  </div>
                  <div style="text-align:center;">{$list->render()}</div>
				  <template>
					
					<Modal v-model="modal1" :title="title" >
						<i-form :model="formData">
						      
							  <h5 style="padding:5px 0px;">渠道名称</h5>
								 <i-input v-model="formData.name" type="text" clearable ></i-input>
                            					    							   
								 <h5 style="padding:10px 0px;">渠道类型</h5>
								 <Radio-group v-model="formData.type">
								{if condition="$type eq 1"}
								<Radio label="1">									
									<span>收入</span>
								</Radio>
								{/if}
								{if condition="$type eq 2"}
								<Radio label="2">									
									<span>付款</span>
								</Radio>
								{/if}
								<!-- <Radio label="3">									
									<span>其他</span>
								</Radio> -->
							</Radio-group >
							<h5 style="padding:10px 0px;">货币选择</h5>
							<Radio-group v-model="formData.currency" type="button">
								<Radio label="CNY"><span>人民币</span></Radio>
								<Radio label="USD"><span>美元</span></Radio>
								<Radio label="TWD"><span>台币</span></Radio>
								<Radio label="HKD"><span>港币</span></Radio>
							</Radio-group>
                            <h5 style="padding:10px 0px;">渠道备注</h5>
							<i-input v-model="formData.desc" type="text" clearable ></i-input>							
						</i-form>
						<div slot="footer"> 
						  <i-button type="text" size="large"   @click="modal1=false">取消</i-button> 
						  <i-button type="primary" size="large" {if condition="getuserrole() eq 'advertiser'" } disabled {/if} @click="addPost">确定</i-button> 
						</div>
						
					</Modal>
				</template>
			</div>			
		</div>
	</div>	
</body>
 {include file="./static/html/footer_common.html" /}
  <script>
     new Vue({
        el: '#wrapper',
        data: {
            modal1: false,
			title:"添加渠道",
            id:"{$id}",			
			formData:{
			    id:0,
				name:"",
				desc:"",
				currency:'',
				type:"{$type}"
			 }
        },
		mounted(){		 
		  		  
		},
        methods: {
            
		   openModal(){
		     this.modal1 = true
			 this.title="添加渠道";
			 this.formData ={id:0,name:"",type:"{$type}",desc:"",currency:''}
		   },
		   filterChannel(value){
		     window.location.href = "/finance/channellist?id="+value
		   },
		   editChannel(id){
		     let _that = this
				this.title="编辑修改";
				axios.get('/finance/editChannel?id='+id)
			  .then(function (response) {
				  _that.formData = response.data
				  _that.modal1 = true
			  })
			  .catch(function (error) {
				console.log(error);
			  });
		   },
			addPost(){
			   if( this.formData.name=="" || this.formData.currency=="" )
			   {
			     this.$Message.warning('请填写完整信息!');
				 return false;
			   }
			   axios({
						method: 'post',
						url:'/finance/postChannel',
						data:this.formData
					}).then(res=>{
					  this.modal1 = false
					  this.$Message.success('操作成功');
					  window.location.href = window.location.href
				 })
			}
        }
    })
  </script>
</html>